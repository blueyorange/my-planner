{% set title="questions" %}
{% extends "base.njk" %}
{% macro questionEditor(question) %}
    <div class="container">
        <div class="row">
            <div class="col">
                <h2>Edit</h2>
                <form action="{% if edit %}{{ q._id }}{% endif %}" method="{% if edit %}put{% else %}post{% endif %}">
                    <div class="mb-3">
                        <textarea name="body" class="form-control" id="questionTextarea" rows="10" placeholder="Question markdown">{{ q.body }}</textarea>
                    </div>
                    {% for option in q.options %}
                        <div class="input-group mb-3">
                            <input name="options" type="text" class="form-control" aria-label="Text input with checkbox" value="{{ option }}"/>
                            <div class="input-group-text" value="">
                                {% if q.correct.includes(option) %}
                                    <input class="form-check-input mt-0" type="radio" value="{{ option }}" name="correct" aria-label="Checkbox for following text input" checked/>
                                {% else %}
                                    <input class="form-check-input mt-0" type="radio" value="{{ option }}" name="correct" aria-label="Checkbox for following text input"/>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                    <button type="submit" class="btn btn-primary">Save</button>
                </form>
            </div>
            <div class="col">
                <h2>Preview</h2>
                <div id="question-preview"></div>
            </div>
        </div>
    </div>
    <script src="/previewQuestion.js" type="module"></script>
{% endmacro %}
{% macro questionViewer(q) %}
    <div class="container">
        <div class="row mt-3">
            <div class="d-flex justify-content-around">
                <a href="/questions/{{ q.id }}?edit=true" class="btn btn-primary" role="button">Edit</a>
                <a class="btn btn-primary" role="button">Live poll</a>
            </div>
        </div>
        <div class="row">
            <div class="question">
                <p>{{ parse(q.body) | safe }}</p>
            </div>
        </div>
    </div>
    <style>
        .question img {
            width: 100%;
            height: auto;
        }
    </style>
{% endmacro %}
{% block content %}
    {% include "header.njk" %}
    {% if edit %}
        {{ questionEditor(q) }}
    {% else %}
        {{ questionViewer(q) }}
    {% endif %}
{% endblock %}