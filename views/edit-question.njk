{% set title="questions" %}
{% extends "base.njk" %}
{% block content %}
    {% include "header.njk" %}
    <div class="container">
        <div class="row">
            <div class="col">
                <form action="/questions/create" method="post">
                    <div class="mb-3">
                        <label for="questionTextarea" class="form-label">Question</label>
                        <textarea name="body" class="form-control" id="questionTextarea" rows="10" placeholder="Question markdown" value="{{ q.body }}"></textarea>
                    </div>
                    {% for option in q.options %}
                        <div class="input-group mb-3">
                            <input
                                name="option-{{ loop.index }}"
                                type="text"
                                class="form-control"
                                aria-label="Text input with checkbox"
                                value="option"/>
                            <div class="input-group-text">
                                <input class="form-check-input mt-0" type="radio" value="{{ option }}" name="correct" aria-label="Checkbox for following text input"/>
                            </div>
                        </div>
                    {% endfor %}
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
            <div class="col" id="rendered"></div>
        </div>
    </div>
    <script
        defer
        src="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.js"
        integrity="sha384-Qsn9KnoKISj6dI8g7p1HBlNpVx0I8p1SvlwOldgi3IorMle61nQy4zEahWYtljaz"
        crossorigin="anonymous"></script>
    <script
        defer
        src="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
        crossorigin="anonymous"
        onload=""></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        (function () {
            const form = document.querySelector('form');
            const formData = new FormData(form)
            const optionNodeList = document.querySelectorAll("input[name^='option']")
            const questionNode = document.querySelector("textarea[name='body']");
            const renderedNode = document.querySelector('#rendered');
            function
            onInput (e) {
                const key = e.target.name;
                const value = e.target.value;
                formData[key] = value;
                renderedNode.innerHTML = marked.parse(formData['body']);
                renderedNode
                    .querySelector('table')
                    .classList
                    .add('table');
                renderMathInElement(renderedNode, {
                    delimiters: [
                        {
                            left: '$$',
                            right: '$$',
                            display: true
                        }, {
                            left: '$',
                            right: '$',
                            display: false
                        }
                    ]
                });
            }
            questionNode.addEventListener('input', onInput);
            optionNodeList.forEach(node => {
                node.addEventListener('input', onInput);
            });
        })();
    </script>
{% endblock %}